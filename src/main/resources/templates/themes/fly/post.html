<!--
  _______
 |__   __|
    | |  ___  _ __ __      __ ___  _ __
    | | / _ \| '__|\ \ /\ / // _ \| '__|
    | ||  __/| |    \ V  V /|  __/| |
    |_| \___||_|     \_/\_/  \___||_|
-->
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:include="themes/fly/include/header::commonHeaderCustom(${post.postTitle} + ' - ' + ${siteConfigDTO.webname},~{::style})">
    <style type="text/css">
        .clear{
            clear: both;
        }

        /*生成博客目录的CSS*/
        #menu-tree {
            float:left;
            min-height:20px;
            padding:0 15px 5px 0;
            min-width:200px;
            margin-bottom:10px;
            background-color:#fbfbfb;
            border:1px solid #999;
            -webkit-box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.05);
            -moz-box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.05);
            box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.05)
        }
        #menu-tree li {
            list-style-type:none;
            margin-left:10px;
            padding:5px 5px 0 15px;
            position:relative;
            width:auto
        }
        #menu-tree li::before {
            content:'';
            left:0;
            top:0;
            position:absolute;
            border-left:1px solid #999;
            height:100%;
        }
        #menu-tree li > i {
            font-style:normal;
            cursor:pointer;
            margin-left: 5px;
        }
        #menu-tree > li::before {
            border:0
        }
        #menu-tree > li:first-child > i {
            float:right;
        }
    </style>
</head>
<body>
<div th:include="themes/fly/include/header::commonHeaderContent"></div>

<div class="layui-hide-xs">
    <div class="fly-panel fly-column">
        <div class="layui-container">
            <ul class="layui-clear">
                <li class="layui-hide-xs layui-this"><a th:href="@{/}">文章</a></li>
                <div th:if="${sysUserDTO!=null}" th:remove="tag">
                    <li><a th:href="@{/?q=note}">笔记</a></li>
                    <li><a th:href="@{/essay.html}">随笔<span class="layui-badge-dot"></span></a></li>
                </div>
                <li><a th:href="@{/guestbook.html}">留言<span class="layui-badge-dot"></span></a></li>

                <li><a th:href="@{/about.html}">关于</a></li>
                <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><span class="fly-mid"></span></li>
                <div th:if="${sysUserDTO!=null}" th:remove="tag">
                    <!-- 用户登入后显示 -->
                    <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="#">我发表的贴</a></li>
                    <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="#">我收藏的贴</a></li>
                </div>
            </ul>

            <div class="fly-column-right layui-hide-xs">
                <span class="fly-search"><i class="layui-icon"></i></span>
                <a href="add.html" class="layui-btn" sec:authorize="hasRole('ROLE_ADMIN')">发表新帖</a>
            </div>
            <div class="layui-hide-sm layui-show-xs-block" style="margin-top: -10px; padding-bottom: 10px; text-align: center;" sec:authorize="hasRole('ROLE_ADMIN')">
                <a href="#" class="layui-btn">发表新帖</a>
            </div>
        </div>
    </div>
</div>

<div class="layui-container">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12 content detail">
            <div class="fly-panel detail-box">
                <h1 th:text="${post.postTitle}">postTitle</h1>
                <div class="fly-detail-info">
                    <!-- <span class="layui-badge">审核中</span> -->
                    <!--<span class="layui-badge layui-bg-green fly-detail-column">动态</span>-->

                    <span class="layui-badge" style="background-color: #999;">未结</span>
                    <!-- <span class="layui-badge" style="background-color: #5FB878;">已结</span> -->

                    <!--<span class="layui-badge layui-bg-black">置顶</span>-->
                    <!--<span class="layui-badge layui-bg-red">精帖</span>-->

                    <!--<div class="fly-admin-box" data-id="123">-->
                        <!--<span class="layui-btn layui-btn-xs jie-admin" type="del">删除</span>-->

                        <!--<span class="layui-btn layui-btn-xs jie-admin" type="set" field="stick" rank="1">置顶</span>-->
                        <!-- <span class="layui-btn layui-btn-xs jie-admin" type="set" field="stick" rank="0" style="background-color:#ccc;">取消置顶</span> -->

                        <!--<span class="layui-btn layui-btn-xs jie-admin" type="set" field="status" rank="1">加精</span>-->
                        <!-- <span class="layui-btn layui-btn-xs jie-admin" type="set" field="status" rank="0" style="background-color:#ccc;">取消加精</span> -->
                    <!--</div>-->
                    <span class="post-date" style="padding: 0 10px;" th:text="${#dates.format(post.postDate, 'yyyy-MM-dd HH:mm:ss')}"></span>
                    <span class="fly-list-nums">
                        <a href="#comment"><i class="iconfont" title="回答">&#xe60c;</i>
                            <span th:text="${post.commentCount}"></span>
                        </a>
                        <i class="iconfont" title="人气">&#xe60b;</i> 62
                    </span>
                </div>
                <div class="detail-about">
                    <a class="fly-avatar" href="../user/home.html">
                        <img src="https://tvax1.sinaimg.cn/crop.0.0.540.540.180/0075uTFdly8fs75paasl1j30f00f0afd.jpg" alt="小布">
                    </a>
                    <div class="fly-detail-user">
                        <a href="../user/home.html" class="fly-link">
                            <cite>小布</cite>
                            <i class="iconfont icon-renzheng" title="认证信息：{{ rows.user.approve }}"></i>
                            <i class="layui-badge fly-badge-vip">VIP3</i>
                        </a>
                    </div>
                    <div class="detail-hits" id="LAY_jieAdmin" data-id="123">
                        <span style="padding-right: 10px; color: #FF7200">悬赏：60飞吻</span>
                        <span class="layui-btn layui-btn-xs jie-admin" type="edit" sec:authorize="hasRole('ROLE_ADMIN')">
                            <a th:href="@{|/${siteConfigDTO.adminpath}/?action=postManage/edit/${post.postId}&title=编辑文章|}">编辑</a>
                        </span>
                    </div>
                </div>
                <div class="detail-body photos">
                    <div id="menu-tree" style="display: none;"></div>
                    <div class="clear"></div>
                    <div id="article-content" class="post-content" th:utext="${post.postContent}">postContent</div>
                    <p>
                        本站模版由 BuguCMS（<a href="https://github.com/terwer/bugucms" target="_blank">bugucms.terwergreen.com</a>）倾情提供，只为表明我们对 BuguCMS 执着的信念、以及对未来持续加强的承诺，可作为通用型博客、管理后台或者企业网站等内容管理系统的页面支撑。
                    </p>
                    <p>更新日志：</p>
                    <pre>
# v1.0 2018-9-14
* 采用 layui 2.3.0 作为 UI 支撑
* 全面同步最新的 Fly 社区风格，各种细节得到大幅优化
* 更友好的响应式适配能力
</pre>
                    下载<hr>
                    <p>
                        官网：<a href="http://www.terwergreen.com/" target="_blank">http://bugucms.terwergreen.com</a><br>
                        码云：<a href="https://gitee.com/youweics/bugucms" target="_blank">https://gitee.com/youweics/bugucms</a><br>
                        GitHub：<a href="https://github.com/terwer/bugucms" target="_blank">https://github.com/terwer/bugucms</a>
                    </p>
                </div>
            </div>

            <div class="fly-panel detail-box" id="flyReply">
                <fieldset class="layui-elem-field layui-field-title" style="text-align: center;">
                    <legend>回帖</legend>
                </fieldset>

                <!--PC和WAP自适应版-->
                <div id="SOHUCS" th:sid="${post.postId}" ></div>
                <script type="text/javascript">
                    (function(){
                        var appid = 'cytOAYsQ3';
                        var conf = 'prod_802873e63fec48cc9dd8666aa725a3d7';
                        var width = window.innerWidth || document.documentElement.clientWidth;
                        if (width < 960) {
                            window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })();
                </script>

                <!--<ul class="jieda" id="jieda">-->
                    <!--<li data-id="111" class="jieda-daan">-->
                        <!--<a name="item-1111111111"></a>-->
                        <!--<div class="detail-about detail-about-reply">-->
                            <!--<a class="fly-avatar" href="">-->
                                <!--<img src="https://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg" alt=" ">-->
                            <!--</a>-->
                            <!--<div class="fly-detail-user">-->
                                <!--<a href="" class="fly-link">-->
                                    <!--<cite>贤心</cite>-->
                                    <!--<i class="iconfont icon-renzheng" title="认证信息：XXX"></i>-->
                                    <!--<i class="layui-badge fly-badge-vip">VIP3</i>-->
                                <!--</a>-->

                                <!--<span>(楼主)</span>-->
                                <!--&lt;!&ndash;-->
                                <!--<span style="color:#5FB878">(管理员)</span>-->
                                <!--<span style="color:#FF9E3F">（社区之光）</span>-->
                                <!--<span style="color:#999">（该号已被封）</span>-->
                                <!--&ndash;&gt;-->
                            <!--</div>-->

                            <!--<div class="detail-hits">-->
                                <!--<span>2017-11-30</span>-->
                            <!--</div>-->

                            <!--<i class="iconfont icon-caina" title="最佳答案"></i>-->
                        <!--</div>-->
                        <!--<div class="detail-body jieda-body photos">-->
                            <!--<p>香菇那个蓝瘦，这是一条被采纳的回帖</p>-->
                        <!--</div>-->
                        <!--<div class="jieda-reply">-->
              <!--<span class="jieda-zan zanok" type="zan">-->
                <!--<i class="iconfont icon-zan"></i>-->
                <!--<em>66</em>-->
              <!--</span>-->
                            <!--<span type="reply">-->
                <!--<i class="iconfont icon-svgmoban53"></i>-->
                <!--回复-->
              <!--</span>-->
                            <!--<div class="jieda-admin">-->
                                <!--<span type="edit">编辑</span>-->
                                <!--<span type="del">删除</span>-->
                                <!--&lt;!&ndash; <span class="jieda-accept" type="accept">采纳</span> &ndash;&gt;-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</li>-->

                    <!--<li data-id="111">-->
                        <!--<a name="item-1111111111"></a>-->
                        <!--<div class="detail-about detail-about-reply">-->
                            <!--<a class="fly-avatar" href="">-->
                                <!--<img src="https://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg" alt=" ">-->
                            <!--</a>-->
                            <!--<div class="fly-detail-user">-->
                                <!--<a href="" class="fly-link">-->
                                    <!--<cite>贤心</cite>-->
                                <!--</a>-->
                            <!--</div>-->
                            <!--<div class="detail-hits">-->
                                <!--<span>2017-11-30</span>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div class="detail-body jieda-body photos">-->
                            <!--<p>蓝瘦那个香菇，这是一条没被采纳的回帖</p>-->
                        <!--</div>-->
                        <!--<div class="jieda-reply">-->
              <!--<span class="jieda-zan" type="zan">-->
                <!--<i class="iconfont icon-zan"></i>-->
                <!--<em>0</em>-->
              <!--</span>-->
                            <!--<span type="reply">-->
                <!--<i class="iconfont icon-svgmoban53"></i>-->
                <!--回复-->
              <!--</span>-->
                            <!--<div class="jieda-admin">-->
                                <!--<span type="edit">编辑</span>-->
                                <!--<span type="del">删除</span>-->
                                <!--<span class="jieda-accept" type="accept">采纳</span>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</li>-->

                    <!--&lt;!&ndash; 无数据时 &ndash;&gt;-->
                    <!--&lt;!&ndash; <li class="fly-none">消灭零回复</li> &ndash;&gt;-->
                <!--</ul>-->
                <!--<div class="layui-form layui-form-pane">-->
                    <!--<form action="/jie/reply/" method="post">-->
                        <!--<div class="layui-form-item layui-form-text">-->
                            <!--<a name="comment"></a>-->
                            <!--<div class="layui-input-block">-->
                                <!--<textarea id="L_content" name="content" required lay-verify="required" placeholder="请输入内容"  class="layui-textarea fly-editor" style="height: 150px;"></textarea>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div class="layui-form-item">-->
                            <!--<input type="hidden" name="jid" value="123">-->
                            <!--<button class="layui-btn" lay-filter="*" lay-submit>提交回复</button>-->
                        <!--</div>-->
                    <!--</form>-->
                <!--</div>-->
            </div>
        </div>
        <!--<div class="layui-col-md4">-->
            <!--<div class="fly-panel">-->
                <!--<div class="fly-panel-title">-->
                    <!--重磅推荐-->
                <!--</div>-->
                <!--<div class="fly-panel-main">-->
                    <!--<a href="https://github.com/terwer/bugucms" target="_blank" class="fly-zanzhu" time-limit="2017.09.25-2099.01.01" style="background-color: #5FB878;">BuguCMS 1.0 - CMS旗舰之作</a>-->
                <!--</div>-->
            <!--</div>-->

            <!--<div class="fly-panel" style="padding: 10px 0; text-align: center;">-->
                <!--<img th:src="@{|/themes/${siteConfigDTO.webtheme}/images/mp-qrcode.png|}" style="max-width: 95%;" alt="layui">-->
                <!--&lt;!&ndash;<p style="position: relative; color: #666;">微信扫码关注 BuguCMS 公众号</p>&ndash;&gt;-->
            <!--</div>-->

            <!--<dl class="fly-panel fly-list-one">-->
                <!--<dt class="fly-panel-title">本周热议</dt>-->
                <!--<dd th:if="false">-->
                    <!--<a href="">基于 layui 的极简社区页面模版</a>-->
                    <!--<span><i class="iconfont icon-pinglun1"></i> 16</span>-->
                <!--</dd>-->
                <!--&lt;!&ndash; 无数据时 &ndash;&gt;-->
                <!--<div class="fly-none">没有相关数据</div>-->
            <!--</dl>-->
        <!--</div>-->
    </div>
</div>

<div th:include="themes/fly/include/footer::commonFooterCustom(~{::script})">
    <script type="text/javascript">
        layui.config({
            version: "3.0.0"
            ,base: window.BUGUCMS_THEME_PATH + 'js/' //这里实际使用时，建议改成绝对路径
        }).extend({
            fly: 'post'
        }).use('fly');

        //构造树
        function buildTreeData(tree, node) {
            if (tree.childrens.length == 0) {
                tree.childrens.push(node);
            } else {
                var lastNode = tree.childrens[tree.childrens.length - 1];
                if (node.tagName > lastNode.tagName) {
                    buildTreeData(lastNode, node);
                } else {
                    tree.childrens.push(node);
                }
            }
        }

        //初始化生成树
        function initTree(note) {
            var result = $("<li>" + note.text + "</li>");
            var size = note.childrens.length;
            if (size > 0) {
                var toggle = $("<i title='展开'>[+]</i>");
                toggle.on('click', function (e) {
                    var children = $(this).next('ul');
                    if (children.is(":visible")) {
                        children.hide('fast');
                        $(this).attr('title', '展开').text("[+]");
                    } else {
                        children.show('fast');
                        $(this).attr('title', '关闭').text("[-]");
                    }
                    e.stopPropagation();
                });
                result.append(toggle);

                var ul = $("<ul style='display: none;'></ul>");
                for (var i = 0; i < size; i++) {
                    ul.append(initTree(note.childrens[i]));
                }
                result.append(ul);

                // 默认展开
                toggle.click();
            }

            return result;
        }


        //生成目录菜单树
        $(function () {
            var tree= {tagName:"H0",text:"<span>目录<span>",childrens:[]};
            var tags = ['H1','H2', 'H3', 'H4', 'H5', 'H6'];
            $.each($('#article-content').children(), function (i, val) {
                if (tags.indexOf(val.tagName) > -1) {
                    var name = "p" + i;
                    $(val).before("<a name='" + name + "'></a>");
                    var node = {
                        tagName: val.tagName,
                        text: "<a href='#" + name + "'>" + val.textContent + "</a>",
                        childrens: []
                    };
                    buildTreeData(tree, node);
                }
            });

            var menuTres = $("#menu-tree");
            if (tree.childrens.length > 0) {
                menuTres.prepend(initTree(tree));
                menuTres.show();
            }else{
                menuTres.hide();
            }
        });
    </script>
</div>
</body>
</html>