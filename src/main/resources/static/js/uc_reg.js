(function(e,t){"use strict";var n=e.$,r='<div class="quc-mod-sign-up quc-clearfix"><div class="quc-left-bar"><ul class="quc-sign-up-type"></ul></div><div class="quc-main"><div class="quc-tip-wrapper quc-global-error"><p class="quc-tip quc-tip-error"></p></div><form class="quc-form" method="post" action="https://i.360.cn/signUp/dosignUpAccount"><p class="quc-field quc-field-submit"><input class="quc-button quc-button-sign-up" type="submit" value="\u7acb\u5373\u6ce8\u518c" /></p><p class="quc-field quc-field-smscodetip"><span><a class="quc-link" href="http://i.360.cn/findpwd/customerhelper#recievemobilecode" target="_blank">\u77ed\u4fe1\u9a8c\u8bc1\u7801\u6ca1\u6536\u5230\uff1f</a></span></p><p class="quc-field quc-field-licence"><label><span>\u70b9\u51fb\u201c\u4e0b\u4e00\u6b65\u201d\uff0c\u5373\u8868\u793a\u60a8\u5df2\u540c\u610f\u5e76\u613f\u610f\u9075\u5b88<a class="quc-link" href="http://i.360.cn/pub/protocol.html" target="_blank">\u300a360\u7528\u6237\u670d\u52a1\u6761\u6b3e\u300b</a></span></label></p><p class="quc-login">\u5df2\u6709\u5e10\u53f7\uff0c<a href="#" class="quc-link quc-link-login">\u7acb\u5373\u767b\u5f55</a></p></form></div></div>',i={mobile:'<p class="quc-field quc-field-mobile quc-input-long"><span class="quc-fixIe6margin"><label class="quc-label"></label></span><span class="quc-input-bg"><input class="quc-input quc-input-mobile" type="tel" name="account" data-name="mobile" maxlength="11" placeholder="\u8bf7\u8f93\u5165\u8981\u6ce8\u518c\u7684\u624b\u673a\u53f7"/></span></p><span class="quc-tip"></span>',email:'<p class="quc-field quc-field-email quc-input-long"><label class="quc-label">\u90ae\u7bb1</label><span class="quc-input-bg"><input class="quc-input quc-input-email" type="text" name="account" data-name="email" autocomplete="off"/></span><i class="quc-tip-icon"></i><span class="quc-tip">\u8bf7\u8f93\u5165\u60a8\u7684\u5e38\u7528\u90ae\u7bb1\uff0c<a class="quc-link" href="http://email.163.com/" target="_blank" tabindex="99">\u6ca1\u6709\u90ae\u7bb1\uff1f</a></span></p>',username:'<p class="quc-field quc-field-username quc-input-long"><label class="quc-label">\u7528\u6237\u540d</label><span class="quc-input-bg"><input class="quc-input quc-input-username" type="text" name="userName" data-name="username" maxlength="14" /></span><i class="quc-tip-icon"></i><span class="quc-tip">2-14\u4e2a\u5b57\u7b26\uff1a\u82f1\u6587\u3001\u6570\u5b57\u6216\u4e2d\u6587</span></p>',nickname:'<p class="quc-field quc-field-nickname quc-input-long"><label class="quc-label">\u6635\u79f0</label><span class="quc-input-bg"><input class="quc-input quc-input-nickname" type="text" name="nickname" maxlength="14" /></span><i class="quc-tip-icon"></i><span class="quc-tip">2-14\u4e2a\u5b57\u7b26\uff1a\u82f1\u6587\u3001\u6570\u5b57\u6216\u4e2d\u6587</span></p>',password:'<p class="quc-field quc-field-password quc-input-long"><span class="quc-fixIe6margin"><label class="quc-label"></label></span><span class="quc-input-bg"><input class="quc-input quc-input-password" type="password" name="password" placeholder="\u5bc6\u7801\u8bf7\u8bbe\u7f6e8-20\u4e2a\u5b57\u7b26" maxlength="20" /></span></p><span class="quc-tip"></span>',passwordAgain:'<p class="quc-field quc-field-password-again quc-input-long"><label class="quc-label">\u786e\u8ba4\u5bc6\u7801</label><span class="quc-input-bg"><input class="quc-input quc-input-password-again" type="password" name="passwordAgain" maxlength="20" /></span><i class="quc-tip-icon"></i><span class="quc-tip">\u8bf7\u518d\u6b21\u8f93\u5165\u5bc6\u7801</span></p>',captcha:'<p class="quc-field quc-field-captcha quc-input-short"><img class="quc-captcha-img quc-captcha-change" alt="\u9a8c\u8bc1\u7801" title="\u70b9\u51fb\u66f4\u6362" tabindex="99" /><span class="quc-input-bg"><input class="quc-input quc-input-captcha" type="text" name="captcha" maxlength="7" placeholder="\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801" autocomplete="off" /></span></p><span class="quc-tip"></span>',smsToken:'<p class="quc-field quc-field-sms-token quc-input-middle quc-clearfix"><span class="quc-sms-tips">\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5df2\u53d1\u9001\u81f3<label class="quc-sms-tips-mobile"></label></span><a href="#" class="quc-get-sms-token">\u514d\u8d39\u83b7\u53d6\u6821\u9a8c\u7801</a><span class="quc-input-bg"><input class="quc-input quc-input-sms-token" type="text" name="smscode" data-name="smsToken" placeholder="\u8bf7\u8f93\u5165\u77ed\u4fe1\u9a8c\u8bc1\u7801" maxlength="6" /></span></p>',nextStep:'<p class="quc-field quc-next-step quc-clearfix"><a href="#" class="quc-nextAndGet-sms-token">\u4e0b\u4e00\u6b65</a></p>'},s={email:{name:"\u90ae\u7bb1\u6ce8\u518c",fields:["email","username","nickname","password","passwordAgain","captcha"]},mobile:{name:"\u624b\u673a\u6ce8\u518c",fields:["mobile","password","captcha","nextStep","smsToken"]},username:{name:"\u7528\u6237\u540d\u6ce8\u518c",fields:["username","nickname","password","passwordAgain","captcha"]}},o={},u={init:function(e){this.model=e,this.initModelEvent(),this.initCaptcha(),this.initSmsToken(),this.initErrorTip()},setElement:function(){o={};var e=this;e.$el&&e.$el.remove(),e.$el=n(r),e.userType=null,e.initNav(),e.$el.on("click",".quc-link-login,.quc-button-login",function(t){t.preventDefault(),e.onSignIn()}),e.$el.find(".quc-form").submit(function(t){t.preventDefault(),e.submit()}),e.$el.find(".quc-next-step").nextAll(".quc-tip").hide(),e.$el.find(".quc-checkbox").on("click",function(){e.model.trigger("afterShow.changeType")})},initModelEvent:function(){var t=this;t.model.on("show",function(e,n){t.show(n&&n.wrapper)}).on("success",function(){var t=e.getConfig("signInBoxWrapper",""),r=e.getConfig("signInBoxOpts",{});t&&e.plugin.signInBox&&n(t).empty().html(e.plugin.signInBox(r))}).on("hide",function(){t.hide()}).on("dealCaptcha",function(){t.$el.find(".quc-field-captcha").hide(),t.$el.find(".quc-input-captcha").val(""),t.$el.find(".quc-input-mobile").off("change").on("change",function(){t.$el.find(".quc-field-captcha").show(),t.$el.find(".quc-captcha-change").trigger("click"),t.model.set("token",null),t.model.trigger("timer_stop")})}).on("showNextStep",function(){n(".reg-title").html("\u4fe1\u606f\u9a8c\u8bc1");var e=t.model.get("mobile");t.userType==="mobile"&&t.$el.find(".quc-sms-tips-mobile").html(e).end().find(".quc-field-mobile").hide().siblings(".quc-tip").hide().end().end().find(".quc-field-captcha").hide().siblings(".quc-tip").hide().end().end().find(".quc-field-password").hide().siblings(".quc-tip").hide().end().end().find(".quc-next-step").hide().end().find(".quc-field-licence").hide().end().find(".quc-field-sms-token").show().parent().append('<span class="quc-tip"></span>').end().end().find(".quc-field-submit").show().end().find(".quc-field-smscodetip").show()})},initCaptcha:function(){var t=this,r,i,s=function(e){var r=e=="mobile"?"strictreg":"reg";t.model.getCaptchaUrl(r,!0).then(function(e){i.find(".quc-captcha-img").attr("src",e),i.find(".quc-input-captcha").val(""),i.find(".quc-tip").removeClass("quc-tip-error").html(function(){return n(this).attr("data-default-tip")}),i.find(".quc-tip-icon").removeClass("quc-tip-icon-incorrect quc-tip-icon-correct")})},o=function(e){s(e),i.show(),i.find(".quc-captcha-change").on("mousedown",function(e){e.preventDefault()}).on("click",function(t){t.preventDefault(),s(e),i.find(".quc-input-captcha").focus()})};t.model.on("changeType",function(e,n){i=t.$el.find(".quc-field-captcha");if(i.length==0)return;(r||(r=t.model.isCaptchaRequired())||n=="mobile")&&o(n)}),this.model.on("invalid",function(t,n){var i=n.type||"reg";!r&&e.utils.getErrorType(n)=="captcha"?(r=!0,o(i)):n.fromServer&&s(i)})},initSmsToken:function(){var t=this,n,r,i,s,o,u="quc-button-disabled",a=e.utils.getTimer("sign_up");a.on("timer_start",function(e,t){r.addClass(u),r.html("\u91cd\u65b0\u83b7\u53d6("+t+"s)")}),a.on("timer_tick",function(e,t){r.html("\u91cd\u65b0\u83b7\u53d6("+t+"s)")}),a.on("timer_stop",function(){r.html("\u91cd\u65b0\u83b7\u53d6\u6821\u9a8c\u7801"),r.removeClass(u)}),t.model.on("timer_stop",function(){a.stop()});var f=function(e){e.preventDefault();var o=r.siblings(".quc-tip-icon");if(r.hasClass(u))return;t.model.set("mobile",n.val()),t.model.set("captcha",s.val()),r.html("\u53d1\u9001\u4e2d..."),r.addClass(u),o.hide(),t.model.trigger("afterShow.changeType"),t.model.sendSmsToken().done(function(e){var n=i.find(".quc-tip");n.addClass("quc-tip-success").html("\u53d1\u9001\u6210\u529f").show(),i.find(".quc-input").one("change",function(){n.removeClass("quc-tip-success").html(n.attr("data-default-tip"))}),o.show(),a.start(),t.model.set("token",e.vt),t.model.trigger("showNextStep"),t.model.trigger("dealCaptcha")}).fail(function(e){o.show(),r.html("\u514d\u8d39\u83b7\u53d6\u6821\u9a8c\u7801"),r.removeClass(u),e.type="mobile";var n=e.errdetail&&e.errdetail.captchaUrl;n&&(e.fromServer=!0,t.model.setCaptchaUrl(n)),t.model.trigger("invalid",e)})};this.model.on("changeType",function(){i=t.$form.find(".quc-field-sms-token"),n=t.$form.find(".quc-input-mobile"),s=t.$form.find(".quc-input-captcha"),o=t.$form.find(".quc-nextAndGet-sms-token"),r=i.find(".quc-get-sms-token");if(i.length==0)return;o.off("click").on("click",function(){r.trigger("click")}),r.off("click",f).on("click",f),a.isRunning()&&a.resume()})},initErrorTip:function(){var e=this;e.model.on("invalid",function(t,n){var r=n.field||e.getErrorField(n.errno),i=r.find(".quc-input-bg"),s=r.hasClass("quc-global-error")?r.find(".quc-tip"):r.next(".quc-tip"),o=r.find(".quc-tip-icon");e.$el.find(".quc-tip").html(""),s.removeClass("quc-tip-success").addClass("quc-tip-error").html(n.errmsg).show(),o.removeClass("quc-tip-icon-incorrect").addClass("quc-tip-icon-incorrect"),i.addClass("quc-input-bg-incorrect"),r.find(".quc-input").one("focus quc-validate",function(){s.removeClass("quc-tip-error").html(""),o.removeClass("quc-tip-icon-incorrect"),i.removeClass("quc-input-bg-incorrect")})}),e.model.on("afterShow.changeType",function(){e.$el.find(".quc-global-error .quc-tip").html("")})},initNav:function(){var e=this,t=this.model.getTypes(),r=this.$el.find(".quc-left-bar").show().find(".quc-sign-up-type").empty();n.each(t,function(t,i){if(s[i]){var o=n("<a>").attr("href","#").html(s[i].name).prepend(n("<i>").addClass("quc-icon quc-icon-"+i)).click(function(t){t.preventDefault(),e.changeType(i)});n("<li>").addClass("quc-type-"+i).append(o).appendTo(r)}}),this.changeType(t[0])},onSignIn:function(){this.model.signIn()},getFieldEl:function(e){var t=this,r=i[e],s=n(r);return s.find(".quc-input").on("focus",function(e){logger.debug("focus",e.target),n(this).parent().addClass("quc-input-bg-focus"),n(this).attr("name")=="account"||n(this).attr("name")=="password"?n(this).parent().parent().addClass("input-focus"):n(this).parent().addClass("input-focus")}).on("blur",function(e){logger.debug("blur",e.target),n(this).parent().removeClass("quc-input-bg-focus"),n(this).attr("name")=="account"||n(this).attr("name")=="password"?n(this).parent().parent().removeClass("input-focus"):n(this).parent().removeClass("input-focus"),t.validate(s),s.hasClass("quc-field-password")&&t.validate(s.siblings(".quc-field-password-again")),s.hasClass("quc-field-password-again")&&t.validate(s.siblings(".quc-field-password"))}),s},getFormEl:function(t){var r=this;if(!o[t]){if(!s[t]){r.model.reportWarn("\u672a\u5b9a\u4e49\u7684\u7c7b\u522b typeConf:"+t);return}var i=n("<div>");n.each(s[t].fields,function(e,n){r.model.isShowField(n,t)&&i.append(r.getFieldEl(n))}),o[t]=i,e.utils.emailHint(i.find(".quc-input-email"))}return o[t][0]},getErrorField:function(t){var n=e.utils.getErrorType(t);return n=="account"?this.$form.find(".quc-field-"+this.userType):n!="other"?this.$form.find(".quc-field-"+n):this.$el.find(".quc-global-error")},changeType:function(e){var t=this.$el.find(".quc-sign-up-type .quc-type-"+e);t.length>0&&this.userType!=e&&(t.addClass("quc-current"),t.siblings(".quc-current").removeClass("quc-current"),this.$form&&this.$form.detach(),this.$form=n(this.getFormEl(e)),this.$form.prependTo(this.$el.find(".quc-form")),this.model.trigger("DOMUpdated",this.$el),this.$el.triggerHandler("QucDOMUpdated"),this.model.trigger("afterShow.changeType",this.$el[0]),this.model.trigger("changeType",e),this.userType=e,this.$form.find(".quc-field .quc-tip").attr("data-default-tip",function(){return n(this).html()}),this.model.clear())},validate:function(e){var t=this,r=e.find(".quc-input").filter(function(){return n(this).is(":visible")}),i=r.attr("data-name")||r.attr("name"),s=r.val();if(e.length==0||s.length==0)return;r.trigger("quc-validate"),t.model.validate(i,s,!0).done(function(){i=="password"&&t.model.set("pwderror",!1);var n=e.find(".quc-tip-icon");n.removeClass("quc-tip-icon-incorrect").addClass("quc-tip-icon-correct"),r.one("focus",function(){n.removeClass("quc-tip-icon-correct")})}).fail(function(n){i=="password"&&t.model.set("pwderror",n),n.field=e,t.model.trigger("invalid",n)}).always(function(){i=="password"&&t.model.set("oldpwd",s)})},submit:function(){var e=this,t=e.$el.find(".quc-button-sign-up");e.$el.find(".quc-form input:not(:submit, :button)").each(function(t,r){var i=n(r),s=i.attr("data-name")||i.attr("name"),o=n.inArray(i.attr("type"),["checkbox","radio"])>=0?i.prop("checked"):i.val();e.model.set(s,o)}),t.prop("disabled",!0).val("\u6ce8\u518c\u4e2d..."),e.model.one("invalid",function(){t.prop("disabled",!1).val("\u7acb\u5373\u6ce8\u518c")}),e.model.set("isNeedCheckCaptcha",e.$el.find(".quc-field-captcha:visible")[0]?!0:!1),e.model.set("userType",this.userType),e.model.submit()},show:function(t){this.setElement();if(!t){var r=this.panel=new e.utils.Panel;r.setTitle(e.getConfig("signUp.panelTitle","\u6b22\u8fce\u6ce8\u518c360\u5e10\u53f7")),r.setContent(this.$el),this.model.trigger("beforeShow",this.$el[0]),r.show(),n(r).on("close",e.getConfig("signUp.panelCloseHandler",n.noop));var i=e.utils.browser;(i.ie6||i.ie7)&&r.setSize(i.ie6?564:544)}else this.model.trigger("beforeShow",this.$el[0]),n(t).addClass("quc-wrapper quc-page").empty().append(this.$el);n("#regWrap").show(),this.model.trigger("afterShow",this.$el[0])},hide:function(){this.model.trigger("beforeHide",this.$el[0]),this.panel&&this.panel.hide(),this.model.trigger("afterHide",this.$el[0])}};e.ui.signUp={init:function(){u.init.apply(u,arguments)},changeType:function(e){u.changeType(e)}}})(QHPass,QUCi360),function(e,t){"use strict";var n=e.$,r={email:1,mobile:2,username:4},i,s=e.getLogic({name:"signUp",validate:function(r,i,s){var o=e.validate,u;if(!r)return;typeof i=="boolean"&&(i=this.get(r));switch(r.toLowerCase()){case"mobile":u=o.checkMobile(i);break;case"email":u=o.checkEmail(i);break;case"username":u=o.checkUsername(i);break;case"nickname":u=o.checkNickname(i);break;case"password":this.set("password",i);var a=o.checkPasswordFrontendSync({password:i,username:this.get("username")});u=a.reason;break;case"passwordagain":u=o.checkPasswordConfirm(this.get("password"),i);break;case"captcha":u=o.checkCaptcha(i);break;case"smstoken":u=o.checkSmsToken(i)}if(!s)return u;var f=e.sync,l=n.Deferred();if(u)return l.reject(u);switch(r.toLowerCase()){case"mobile":return f.checkMobileNumberExist(i);case"email":return f.checkEmailExist(i);case"password":return t.sync.checkWeakPwd(i);case"username":return f.checkUsernameExist(i);case"nickname":return f.checkNicknameExist(i);default:return l.resolve()}},isCaptchaRequired:function(){return i},prepareCaptcha:function(){var t=this;return e.sync.checkSignUpCaptchaRequired().then(function(e){i=e.captchaFlag,t.setCaptchaUrl(e.captchaUrl)},function(){return i=!0,n.Deferred().resolve().promise()})},isShowField:function(t,r){var i=n.inArray(t,["username","nickname","passwordAgain"])>=0,s="signUp.hide"+t.substr(0,1).toUpperCase()+t.substr(1);return!i||r==t||!e.getConfig(s,!1)},sendSmsToken:function(){var t=this.get("mobile"),r=this.get("password")===undefined?"":this.get("password"),i=this.get("captcha"),s=this.get("token"),o=this.validate("mobile",t)||this.get("pwderror")||(s?!1:this.validate("captcha",i));return o?n.Deferred().reject(o).promise():e.sync.sendSmsTokenNeedPhrase(null,!1,t,i,s,"reg")},run:function(t){var n=this;n.init().trigger("showLoading"),n.prepareCaptcha().then(function(){return e.activeEmail.prepare(n,t)}).done(function(){n.trigger("hideLoading").trigger("show",{wrapper:t})})},getTypes:function(){return e.getConfig("signUp.types",["mobile","email"])},submit:function(){var t=this,s=t.get("userType"),o=t.get("isNeedCheckCaptcha",!1),u=r[s];t.set("agreeLicence",!0);if(!u){t.model.reportWarn("\u672a\u5b9a\u4e49\u7684\u7c7b\u522b typeConf:"+s);return}this.trigger("beforeSubmit");var a={acctype:u,account:t.get(s),password:t.get("password")};a.emailActiveFlag=e.getConfig("signUp.sendActiveEmail",!0),n.each(["username","nickname","passwordAgain","smsToken","agreeLicence"],function(e,n){var r=t.get(n,undefined);r!==undefined&&(a[n]=r)}),o&&(a.captcha=t.get("captcha"));var f=!1,l={mobile:t.get("mobile"),email:t.get("email")};n.each(n.extend({},a,l),function(e,n){var r=t.validate(e,n);r&&t.trigger("invalid",r),f=f||r}),!f&&e.sync.signUp(a).then(function(r){var i=n.Deferred();return r.activeurl?(r.email=t.get("email"),e.activeEmail(r,function(){e.sync.getRd().done(function(e){i.resolve(e)}).fail(function(){t.signIn()})})):(r.rd=encodeURIComponent(r.rd),i.resolve(r)),i.promise()}).then(function(t){return e.sync.setCookie(t.rd)}).then(function(){return e.getUserInfo(!1)}).done(function(e){t.trigger("hide").trigger("success",e).resolve(e)}).fail(function(e){e.fromServer=!0;var n=e.errdetail&&e.errdetail.captchaUrl;n&&(i=!0,t.setCaptchaUrl(n)),t.trigger("invalid",e)})},signIn:function(){var t=this.getCallback();e.signIn?(this.trigger("hide"),e.signIn(t)):location.href="http://i.360.cn/login/?src="+e.getConfig("src")+"&destUrl="+encodeURIComponent(typeof t=="string"?t:location.href)}});e.signUp=function(e,t){e&&e.nodeType!=1&&!(e instanceof n)&&(t=e,e=undefined),s.setCallback(t).run(e)},e.setConfig("signUp.hideNickname",!0)}(QHPass,QUCi360)